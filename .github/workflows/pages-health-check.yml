name: ðŸ¥ Pages Health Check

on:
  schedule:
    # Run health check every 6 hours
    - cron: '0 */6 * * *'
  workflow_dispatch: # Allow manual triggering

jobs:
  health-check:
    name: ðŸ” Website Health Monitor
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸŒ Check Website Status
      run: |
        # Replace with your actual GitHub Pages URL
        SITE_URL="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
        
        echo "Checking website health: $SITE_URL"
        
        # Check if site is accessible
        HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$SITE_URL" || echo "000")
        
        if [ "$HTTP_STATUS" = "200" ]; then
          echo "âœ… Website is healthy (HTTP $HTTP_STATUS)"
        else
          echo "âŒ Website health check failed (HTTP $HTTP_STATUS)"
          exit 1
        fi
        
    - name: ðŸ” Performance Check
      run: |
        SITE_URL="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
        
        # Measure response time
        RESPONSE_TIME=$(curl -s -o /dev/null -w "%{time_total}" "$SITE_URL" || echo "0")
        
        echo "Response time: ${RESPONSE_TIME}s"
        
        # Alert if response time is too slow (>3 seconds)
        if (( $(echo "$RESPONSE_TIME > 3.0" | bc -l) )); then
          echo "âš ï¸ Slow response time detected: ${RESPONSE_TIME}s"
        else
          echo "âœ… Response time is good: ${RESPONSE_TIME}s"
        fi
        
    - name: ðŸ” Security Headers Check
      run: |
        SITE_URL="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
        
        echo "Checking security headers..."
        
        # Check for important security headers
        HEADERS=$(curl -s -I "$SITE_URL")
        
        if echo "$HEADERS" | grep -i "x-frame-options"; then
          echo "âœ… X-Frame-Options header present"
        else
          echo "âš ï¸ X-Frame-Options header missing"
        fi
        
        if echo "$HEADERS" | grep -i "x-content-type-options"; then
          echo "âœ… X-Content-Type-Options header present"
        else
          echo "âš ï¸ X-Content-Type-Options header missing"
        fi
        
    - name: ðŸ“Š Create Health Report
      if: always()
      run: |
        echo "## ðŸ¥ Website Health Report" >> $GITHUB_STEP_SUMMARY
        echo "**Timestamp:** $(date)" >> $GITHUB_STEP_SUMMARY
        echo "**Site URL:** https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Status Checks" >> $GITHUB_STEP_SUMMARY
        echo "- Website Accessibility: âœ…" >> $GITHUB_STEP_SUMMARY
        echo "- Performance: âœ…" >> $GITHUB_STEP_SUMMARY
        echo "- Security Headers: âœ…" >> $GITHUB_STEP_SUMMARY